CREATE DATABASE IF NOT EXISTS IntercambioYA;
USE IntercambioYA;


CREATE TABLE Usuario (
    id_usuario INT AUTO_INCREMENT PRIMARY KEY,
    primer_nombre VARCHAR(50) NOT NULL,
    primer_apellido VARCHAR(50) NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    contraseña VARCHAR(100) NOT NULL,
    descripcion TEXT,
    foto_perfil VARCHAR(255),
    fecha_registro DATE
);


CREATE TABLE Telefono_usuario (
    id_tel INT AUTO_INCREMENT PRIMARY KEY,
    id_usuario INT,
    numero VARCHAR(20),
    FOREIGN KEY (id_usuario) REFERENCES Usuario(id_usuario)
);


CREATE TABLE Producto (
    id_producto INT AUTO_INCREMENT PRIMARY KEY,
    id_usuario INT,
    nombre VARCHAR(100) NOT NULL,
    estado VARCHAR(50) NOT NULL,
    foto VARCHAR(255),
    descripcion TEXT,
    FOREIGN KEY (id_usuario) REFERENCES Usuario(id_usuario)
);


CREATE TABLE Trueque (
    id_trueque INT AUTO_INCREMENT PRIMARY KEY,
    estado VARCHAR(50) NOT NULL,
    fecha_creacion DATE
);


CREATE TABLE Ofrece (
    id_trueque INT,
    id_usuario INT,
    PRIMARY KEY (id_trueque, id_usuario),
    FOREIGN KEY (id_trueque) REFERENCES Trueque(id_trueque),
    FOREIGN KEY (id_usuario) REFERENCES Usuario(id_usuario)
);


CREATE TABLE Recibe (
    id_trueque INT,
    id_usuario INT,
    PRIMARY KEY (id_trueque, id_usuario),
    FOREIGN KEY (id_trueque) REFERENCES Trueque(id_trueque),
    FOREIGN KEY (id_usuario) REFERENCES Usuario(id_usuario)
);


CREATE TABLE Detalle_Trueque (
    id_detalle INT AUTO_INCREMENT PRIMARY KEY,
    id_trueque INT,
    condiciones TEXT,
    FOREIGN KEY (id_trueque) REFERENCES Trueque(id_trueque)
);


CREATE TABLE Chat (
    id_chat INT AUTO_INCREMENT PRIMARY KEY,
    fecha_inicio DATE
);


CREATE TABLE Genera (
    id_trueque INT PRIMARY KEY,
    id_chat INT UNIQUE,
    FOREIGN KEY (id_trueque) REFERENCES Trueque(id_trueque),
    FOREIGN KEY (id_chat) REFERENCES Chat(id_chat)
);


CREATE TABLE Mensaje (
    id_mensaje INT AUTO_INCREMENT PRIMARY KEY,
    id_chat INT,
    fecha_envio DATETIME,
    contenido TEXT,
    FOREIGN KEY (id_chat) REFERENCES Chat(id_chat)
);


CREATE TABLE Administrador (
    id_admin INT AUTO_INCREMENT PRIMARY KEY,
    email VARCHAR(100) UNIQUE NOT NULL,
    primer_nombre VARCHAR(50) NOT NULL,
    primer_apellido VARCHAR(50) NOT NULL,
    contraseña VARCHAR(100) NOT NULL,
    rol VARCHAR(50)
);


CREATE TABLE Supervisa (
    id_supervision INT AUTO_INCREMENT PRIMARY KEY,
    id_trueque INT,
    id_usuario INT,
    id_detalle INT,
    id_chat INT,
    id_mensaje INT,
    id_admin INT,
    fecha_supervision DATE,
    FOREIGN KEY (id_trueque) REFERENCES Trueque(id_trueque),
    FOREIGN KEY (id_usuario) REFERENCES Usuario(id_usuario),
    FOREIGN KEY (id_detalle) REFERENCES Detalle_Trueque(id_detalle),
    FOREIGN KEY (id_chat) REFERENCES Chat(id_chat),
    FOREIGN KEY (id_mensaje) REFERENCES Mensaje(id_mensaje),
    FOREIGN KEY (id_admin) REFERENCES Administrador(id_admin)
);